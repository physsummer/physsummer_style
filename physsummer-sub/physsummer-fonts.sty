\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{physsummer-fonts}

\RequirePackage{ifpdf}
\RequirePackage{ifluatex}
\RequirePackage{mathtools}

\ifpdf
    \ifluatex % if LuaLaTex, then 
        \RequirePackage{luatextra} % LuaLaTeX fontspec и макросы
        \RequirePackage{polyglossia}  
        \setdefaultlanguage{russian}
        \usepackage[unicode]{hyperref}
        \else % if pdflatex, then
        \DeclareOption*{
            \message{pdflatex, font options will be ignored.}
        }
        \ProcessOptions
        \RequirePackage[T2A]{fontenc}
        \RequirePackage[russian]{babel}
        \RequirePackage[utf8]{inputenc}
        \RequirePackage[unicode]{hyperref}
        \RequirePackage[pdftex]{graphicx}
        \RequirePackage{cmlgc}
        \endinput
    \fi
\else % if xelatex, then
    % xelatex specific packages
    \RequirePackage[xetex]{hyperref}
    \RequirePackage{xltxtra} % \XeLaTeX macro
    \RequirePackage{xunicode} % some extra unicode support
    \defaultfontfeatures{Mapping = tex-text}
    \RequirePackage{polyglossia} % instead of babel in xelatex
    \setdefaultlanguage[spelling = modern]{russian}
\fi

\let\mathbbtemp\mathbb
\RequirePackage{unicode-math}
\let\mathbb\mathbbtemp

\defaultfontfeatures{Renderer = Basic, Ligatures = TeX} % для работы лигатур
\setotherlanguage{english}

\setmainfont{Linux Libertine O}
\newfontfamily{\cyrillicfont}{Linux Libertine O}
\IfFontExistsTF{Linux Biolinum O}{
    \setsansfont{Linux Biolinum O}
}{
    \message{Установите Linux Biolinum O для корректной работы шрифтов.}
}


\IfFontExistsTF{CMU Typewriter Text}{
    \setmonofont{CMU Typewriter Text}
    \newfontfamily{\cyrillicfonttt}{CMU Typewriter Text}
}{
    \message{Установите CMU Typewriter Text для корректной работы шрифтов.}
    \newfontfamily{\cyrillicfonttt}{Linux Libertine O}
}

\DeclareOption{mathfont=lmodern}{
    \IfFontExistsTF{Latin Modern Math}{
        \setmathfont[colon = literal]{Latin Modern Math}
        \IfFontExistsTF{Asana Math}{
            \setmathfont[range = \setminus]{Asana Math}
        }{}
    }{
        \message{Установите Latin Modern Math, Asana Math для корректной работы шрифтов.}
        \setmathfont{Linux Libertine O}
    }
}


\DeclareOption{mathfont=libertinus}{
    \setmathfont{Libertinus Math}
    \IfFontExistsTF{Asana Math}{
        \setmathfont[range = \setminus]{Asana Math}
    }{
        \message{Установите Libertinus Math, Asana Math для корректной работы шрифтов.}
        \setmathfont{Linux Libertine O}
    }
}

\DeclareOption{mathfont=cambria}{
    \setmathfont{Cambria Math}
    \setmathfont[range = {\leqslant, \geqslant}]{Latin Modern Math}
    \IfFontExistsTF{Asana Math}{
        \setmathfont[range = \setminus]{Asana Math}
    }{
        \message{Установите Cambria Math, Latin Modern Math, Asana Math для корректной работы шрифтов.}
        \setmathfont{Linux Libertine O}
    }
}

\ExecuteOptions{mathfont=lmodern}
\ProcessOptions

\endinput